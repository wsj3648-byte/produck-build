<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>동물상 테스트 - 당신의 얼굴은 어떤 동물상과 닮았을까요?</title>
  <meta name="description" content="사진을 업로드하여 당신의 얼굴이 강아지상인지 고양이상인지 재미있게 테스트해보세요. AI가 분석한 결과를 즉시 확인합니다.">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7192940627335402"
     crossorigin="anonymous"></script>
  <style>
    body { 
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; 
      background-color: #fff;
      color: #000;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
    }
    body.dark-mode {
      background-color: #121212;
      color: #fff;
    }
    button { 
      padding: 10px 14px; 
      cursor: pointer; 
      margin: 5px;
    }
    #image-preview {
      max-width: 300px;
      margin-top: 10px;
      border: 1px solid #ccc;
    }
    #label-container {
        margin-top: 10px;
        font-size: 20px;
        font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>동물상 테스트</h1>
  <p>당신의 얼굴이 강아지상인지 고양이상인지 재미있게 확인해보세요! 이미지를 업로드하면 AI가 분석해드립니다.</p>
  <button id="themeBtn" type="button">테마 변경</button>
  <button id="upload-btn" type="button">이미지 업로드</button>
  <input type="file" id="image-upload" accept="image/*" style="display: none;">
  
  <img id="image-preview" src="" alt="Image preview" style="display: none;">
  <div id="label-container"></div>

  <!-- Google AdSense Ad Unit -->
  <ins class="adsbygoogle"
       style="display:block; margin: 20px 0; min-width: 300px; min-height: 50px;"
       data-ad-client="ca-pub-7192940627335402"
       data-ad-slot="YOUR_AD_SLOT_ID"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <a href="index.html" style="margin-top: 20px;">홈으로 돌아가기</a>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  
  <script>
    // --- Dark Mode ---
    const themeBtn = document.getElementById("themeBtn");
    const body = document.body;

    themeBtn.addEventListener("click", () => {
      body.classList.toggle("dark-mode");
      localStorage.setItem("theme", body.classList.contains("dark-mode") ? "dark" : "light");
    });
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark-mode");
    }

    // --- Animal Face Test ---
    const URL = "https://teachablemachine.withgoogle.com/models/W1l93qBXS/";
    let model, labelContainer, maxPredictions;

    const uploadBtn = document.getElementById('upload-btn');
    const imageUpload = document.getElementById('image-upload');
    const imagePreview = document.getElementById('image-preview');
    
    uploadBtn.addEventListener('click', () => imageUpload.click());

    imageUpload.addEventListener('change', async (event) => {
        if (event.target.files && event.target.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                predict(imagePreview);
            }
            reader.readAsDataURL(event.target.files[0]);
        }
    });

    async function initModel() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
        }
    }
    initModel();

    async function predict(image) {
        const prediction = await model.predict(image);
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelContainer.childNodes[i].innerHTML = classPrediction;
        }
    }
  </script>
</body>
</html>