<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì§€ë¢°ì°¾ê¸° - ì‚¬ìš´ë“œ/ì• ë‹ˆ/ìµœê³ ê¸°ë¡</title>
  <style>
    :root{
      --bg0:#070a12; --bg1:#0b1020;
      --card: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.10);
      --txt: #eaf0ff;
      --muted:#a9b7d6;
      --good:#34d399;
      --bad:#ff6b6b;
      --accent:#7dd3fc;
      --shadow: 0 20px 80px rgba(0,0,0,.45);
      --radius: 18px;

      --cellA: rgba(255,255,255,.075);
      --cellB: rgba(255,255,255,.055);
      --cellOpen: rgba(6,10,20,.72);
      --cellLine: rgba(255,255,255,.085);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; color:var(--txt);
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 500px at 20% -10%, rgba(125,211,252,.30), transparent 55%),
        radial-gradient(700px 450px at 90% 10%, rgba(167,139,250,.22), transparent 55%),
        radial-gradient(900px 700px at 50% 120%, rgba(52,211,153,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
    }
    .wrap{ max-width: 1020px; margin: 0 auto; padding: 18px 16px 28px; }

    header{ display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom: 14px; }
    .title{ display:flex; flex-direction:column; gap:6px; }
    .title h1{ margin:0; font-size: 22px; letter-spacing: .2px; }
    .title p{ margin:0; color:var(--muted); font-size: 13px; }

    .panel{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .top{
      display:flex; gap:12px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      padding: 12px;
      margin-bottom: 12px;
    }
    .controls{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .stats{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }

    select, button{
      appearance:none;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.07);
      color: var(--txt);
      padding: 10px 12px;
      font-weight: 800;
      cursor: pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
    }
    button:hover, select:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.16); }
    button:active{ transform: translateY(1px); }
    .toggleOn{
      border-color: rgba(125,211,252,.40);
      background: rgba(125,211,252,.12);
    }

    .pill{
      display:flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-weight: 800;
      white-space: nowrap;
    }
    .pill b{ color: var(--txt); }

    .cards{ padding: 12px; margin-bottom: 12px; }
    .gridCards{ display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 10px; }
    @media (max-width: 720px){ .gridCards{ grid-template-columns: 1fr; } }

    .cardItem{
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.05);
      padding: 12px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      min-height: 56px;
    }
    .cardItem .name{ color: var(--muted); font-weight: 900; letter-spacing:.2px; }
    .cardItem .best{ font-weight: 950; font-size: 16px; }

    .game{ padding: 12px; }
    .boardWrap{ display:flex; justify-content:center; padding: 10px 0 6px; position:relative; }
    .board{
      display:grid;
      border: 1px solid var(--cellLine);
      border-radius: 16px;
      overflow:hidden;
      touch-action: manipulation;
      user-select:none;
    }
    .cell{
      width: 34px; height: 34px;
      display:flex; align-items:center; justify-content:center;
      border-right: 1px solid var(--cellLine);
      border-bottom: 1px solid var(--cellLine);
      background: var(--cellA);
      font-weight: 950;
      font-size: 15px;
      cursor: pointer;
      will-change: transform;
    }
    .cell:nth-child(odd){ background: var(--cellB); }
    .cell.open{ background: var(--cellOpen); cursor: default; }
    .cell.flag{ color: #ffd166; }
    .cell.mine{ background: rgba(255,107,107,.20); }

    .n1{color:#60a5fa}.n2{color:#34d399}.n3{color:#fb7185}.n4{color:#a78bfa}
    .n5{color:#f97316}.n6{color:#22d3ee}.n7{color:#e5e7eb}.n8{color:#facc15}

    .toast{
      margin-top: 10px;
      text-align:center;
      font-weight: 950;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      min-height: 44px;
      display:flex; align-items:center; justify-content:center;
    }
    .toast.win{ color: var(--good); }
    .toast.lose{ color: var(--bad); }

    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.45;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>ì§€ë¢°ì°¾ê¸°</h1>
        <p>íƒ­/í´ë¦­í•˜ë©´ ì‚¬ìš´ë“œê°€ í™œì„±í™”ë¼ìš”(ëª¨ë°”ì¼ ì •ì±… ë•Œë¬¸ì— ì²« ìƒí˜¸ì‘ìš©ì´ í•„ìš”).</p>
      </div>
    </header>

    <section class="panel top">
      <div class="controls">
        <select id="level" aria-label="ë‚œì´ë„">
          <option value="easy">ì´ˆê¸‰ (9x9, 10)</option>
          <option value="medium">ì¤‘ê¸‰ (16x16, 40)</option>
          <option value="hard">ê³ ê¸‰ (16x30, 99)</option>
        </select>
        <button id="newGame" type="button">ìƒˆ ê²Œì„</button>
        <button id="resetBest" type="button">ìµœê³ ê¸°ë¡ ì´ˆê¸°í™”</button>
        <button id="soundBtn" type="button" class="toggleOn">ì‚¬ìš´ë“œ ON</button>
      </div>
      <div class="stats">
        <span class="pill">ì‹œê°„ <b id="time">0</b>s</span>
        <span class="pill">ì§€ë¢° ìˆ˜ <b id="mineCount">0</b></span>
        <span class="pill">ë‚¨ì€ ê¹ƒë°œ <b id="flagsLeft">0</b></span>
        <span class="pill">í˜„ì¬ ë‚œì´ë„ ìµœê³  <b id="bestNow">-</b></span>
      </div>
    </section>

    <section class="panel cards">
      <div class="gridCards">
        <div class="cardItem"><div class="name">ì´ˆê¸‰ ìµœê³ </div><div class="best" id="bestEasy">-</div></div>
        <div class="cardItem"><div class="name">ì¤‘ê¸‰ ìµœê³ </div><div class="best" id="bestMedium">-</div></div>
        <div class="cardItem"><div class="name">ê³ ê¸‰ ìµœê³ </div><div class="best" id="bestHard">-</div></div>
      </div>
    </section>

    <section class="panel game">
      <div class="boardWrap">
        <div id="board" class="board" aria-label="ì§€ë¢° ë³´ë“œ"></div>
      </div>
      <div id="toast" class="toast" aria-live="polite"></div>
      <div class="hint">
        PC: ì¢Œí´ë¦­=ì—´ê¸°, ìš°í´ë¦­=ê¹ƒë°œ / ëª¨ë°”ì¼: íƒ­=ì—´ê¸°, ê¸¸ê²Œ=ê¹ƒë°œ (ì²« í´ë¦­ì€ ì•ˆì „)
      </div>
    </section>
  </div>

<script>
(() => {
  const boardEl = document.getElementById('board');
  const levelEl = document.getElementById('level');
  const newBtn = document.getElementById('newGame');
  const resetBestBtn = document.getElementById('resetBest');
  const soundBtn = document.getElementById('soundBtn');

  const timeEl = document.getElementById('time');
  const mineCountEl = document.getElementById('mineCount');
  const flagsLeftEl = document.getElementById('flagsLeft');
  const bestNowEl = document.getElementById('bestNow');
  const toastEl = document.getElementById('toast');

  const bestEasyEl = document.getElementById('bestEasy');
  const bestMediumEl = document.getElementById('bestMedium');
  const bestHardEl = document.getElementById('bestHard');

  const LEVELS = {
    easy: { rows: 9, cols: 9, mines: 10, label:'ì´ˆê¸‰' },
    medium: { rows: 16, cols: 16, mines: 40, label:'ì¤‘ê¸‰' },
    hard: { rows: 16, cols: 30, mines: 99, label:'ê³ ê¸‰' },
  };

  // localStorage: ë¬¸ìì—´ ì €ì¥ â†’ JSONìœ¼ë¡œ ì €ì¥/ë³µì› [web:185]
  const BEST_KEY = 'ms_best_v3';

  function loadBest() {
    try {
      const raw = localStorage.getItem(BEST_KEY);
      return raw ? JSON.parse(raw) : {};
    } catch { return {}; }
  }
  function saveBest(obj) {
    localStorage.setItem(BEST_KEY, JSON.stringify(obj));
  }
  function getBest(level) {
    const v = loadBest()[level];
    return (typeof v === 'number' && isFinite(v)) ? v : null;
  }
  function setBest(level, seconds) {
    const obj = loadBest();
    obj[level] = seconds;
    saveBest(obj);
  }
  function fmt(sec) { return sec == null ? '-' : `${sec}s`; }
  function refreshBestUI() {
    const b = loadBest();
    bestEasyEl.textContent = fmt((typeof b.easy==='number') ? b.easy : null);
    bestMediumEl.textContent = fmt((typeof b.medium==='number') ? b.medium : null);
    bestHardEl.textContent = fmt((typeof b.hard==='number') ? b.hard : null);
    bestNowEl.textContent = fmt(getBest(levelEl.value));
  }

  // ì‚¬ìš´ë“œ(íŒŒì¼ ì—†ì´ Web Audio í†¤)
  // AudioContext ì•ˆì— oscillatorë¥¼ ë§Œë“¤ì–´ ì†Œë¦¬ë¥¼ ë‚¼ ìˆ˜ ìˆìŒ [web:215][web:218]
  let audioCtx = null;
  let soundOn = true;

  function ensureAudio() {
    if (!soundOn) return null;
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    // ëª¨ë°”ì¼ì—ì„œ 'ì²« ìƒí˜¸ì‘ìš© í›„ ì¬ìƒ' ì •ì±… ë•Œë¬¸ì— resume()ê°€ í•„ìš”í•  ìˆ˜ ìˆìŒ
    if (audioCtx.state === 'suspended') audioCtx.resume();
    return audioCtx;
  }

  function beep({freq=440, dur=0.06, type='sine', vol=0.08} = {}) {
    const ctx = ensureAudio();
    if (!ctx) return;

    const osc = ctx.createOscillator(); // [web:218]
    const gain = ctx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, ctx.currentTime);
    gain.gain.setValueAtTime(vol, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + dur);

    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime + dur);
  }

  function sfxOpen(n) { beep({freq: 520 + (n||0)*20, dur: 0.045, type:'triangle', vol:0.06}); }
  function sfxFlag(on) { beep({freq: on ? 660 : 330, dur: 0.05, type:'square', vol:0.05}); }
  function sfxBoom() { beep({freq: 120, dur: 0.22, type:'sawtooth', vol:0.12}); }
  function sfxWin() {
    // ì§§ì€ ë©œë¡œë””
    beep({freq: 523, dur: 0.07, type:'triangle', vol:0.07});
    setTimeout(()=>beep({freq: 659, dur: 0.07, type:'triangle', vol:0.07}), 90);
    setTimeout(()=>beep({freq: 784, dur: 0.10, type:'triangle', vol:0.08}), 180);
  }

  // ì• ë‹ˆë©”ì´ì…˜: Element.animate()ë¡œ ê°„ë‹¨íˆ ì‹¤í–‰ ê°€ëŠ¥ [web:220]
  function pop(el) {
    if (!el || !el.animate) return;
    el.animate(
      [{ transform:'scale(1)' }, { transform:'scale(1.12)' }, { transform:'scale(1)' }],
      { duration: 160, easing:'cubic-bezier(.2,.8,.2,1)' }
    );
  }
  function confettiBurst() {
    if (!boardEl.animate) return;
    boardEl.animate(
      [
        { filter:'brightness(1)', transform:'translateY(0px) scale(1)' },
        { filter:'brightness(1.35)', transform:'translateY(-2px) scale(1.01)' },
        { filter:'brightness(1)', transform:'translateY(0px) scale(1)' }
      ],
      { duration: 520, easing:'cubic-bezier(.2,.8,.2,1)' }
    );
  }

  // ê²Œì„ ìƒíƒœ
  let rows=9, cols=9, mines=10;
  let grid, minesMap;
  let openedCount=0, flagsCount=0;
  let firstClick=true, gameOver=false;
  let timer=0, timerId=null;

  const OPEN = 1<<4;
  const FLAG = 1<<5;

  function idx(r,c){ return r*cols+c; }
  function inb(r,c){ return r>=0 && r<rows && c>=0 && c<cols; }

  function setToast(msg, kind='') {
    toastEl.textContent = msg || '';
    toastEl.className = 'toast' + (kind ? ' ' + kind : '');
  }

  function resetTimer(){
    timer=0;
    timeEl.textContent='0';
    if (timerId) clearInterval(timerId);
    timerId=null;
  }
  function startTimer(){
    if (timerId) return;
    timerId = setInterval(() => {
      timer++;
      timeEl.textContent = String(timer);
    }, 1000);
  }

  function setConfig(){
    const cfg = LEVELS[levelEl.value] || LEVELS.easy;
    rows=cfg.rows; cols=cfg.cols; mines=cfg.mines;
  }

  function updateCountersUI() {
    mineCountEl.textContent = String(mines);
    flagsLeftEl.textContent = String(Math.max(0, mines - flagsCount));
  }

  function buildBoardDOM(){
    boardEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    const total = rows*cols;
    const frag = document.createDocumentFragment();
    for (let i=0;i<total;i++){
      const d=document.createElement('div');
      d.className='cell';
      d.dataset.i=String(i);
      frag.appendChild(d);
    }
    boardEl.innerHTML='';
    boardEl.appendChild(frag);
  }

  function newGame(){
    setConfig();
    const total=rows*cols;
    grid = new Uint8Array(total);
    minesMap = new Uint8Array(total);
    openedCount=0; flagsCount=0;
    firstClick=true; gameOver=false;
    resetTimer();
    setToast('');
    updateCountersUI();
    buildBoardDOM();
    refreshBestUI();
  }

  function placeMines(safeIndex){
    const safe = new Set();
    const r0 = (safeIndex / cols) | 0;
    const c0 = safeIndex % cols;

    for (let dr=-1; dr<=1; dr++){
      for (let dc=-1; dc<=1; dc++){
        const rr=r0+dr, cc=c0+dc;
        if (inb(rr,cc)) safe.add(idx(rr,cc));
      }
    }

    let placed=0;
    while (placed<mines){
      const i = (Math.random()*(rows*cols))|0;
      if (minesMap[i]) continue;
      if (safe.has(i)) continue;
      minesMap[i]=1;
      placed++;
    }

    for (let r=0;r<rows;r++){
      for (let c=0;c<cols;c++){
        const i=idx(r,c);
        if (minesMap[i]) continue;
        let cnt=0;
        for (let dr=-1; dr<=1; dr++){
          for (let dc=-1; dc<=1; dc++){
            if (dr===0 && dc===0) continue;
            const rr=r+dr, cc=c+dc;
            if (!inb(rr,cc)) continue;
            if (minesMap[idx(rr,cc)]) cnt++;
          }
        }
        grid[i] = (grid[i] & ~0x0f) | cnt;
      }
    }
  }

  function cellEl(i){ return boardEl.children[i]; }

  function revealAllMines(){
    const total=rows*cols;
    for (let i=0;i<total;i++){
      if (!minesMap[i]) continue;
      const el = cellEl(i);
      el.classList.add('mine','open');
      el.textContent='ğŸ’£';
    }
  }

  function toggleFlag(i){
    if (gameOver) return;
    const v = grid[i];
    if (v & OPEN) return;

    const el = cellEl(i);
    if (v & FLAG){
      grid[i] = v & ~FLAG;
      el.classList.remove('flag');
      el.textContent='';
      flagsCount--;
      sfxFlag(false);
    } else {
      grid[i] = v | FLAG;
      el.classList.add('flag');
      el.textContent='ğŸš©';
      flagsCount++;
      sfxFlag(true);
      pop(el);
    }
    updateCountersUI();
  }

  function winCheck(){
    const totalSafe = rows*cols - mines;
    if (openedCount < totalSafe) return;

    gameOver = true;
    if (timerId) clearInterval(timerId);

    const key = levelEl.value;
    const prev = getBest(key);
    const isNew = (prev == null || timer < prev);

    if (isNew) setBest(key, timer);
    refreshBestUI();

    sfxWin();
    confettiBurst();

    setToast(
      isNew ? `í´ë¦¬ì–´! ìµœê³ ê¸°ë¡ ê°±ì‹ : ${timer}s` : `í´ë¦¬ì–´! ê¸°ë¡: ${timer}s (ìµœê³ : ${prev}s)`,
      'win'
    );
  }

  function openCell(i){
    if (gameOver) return;
    const v = grid[i];
    if (v & OPEN) return;
    if (v & FLAG) return;

    if (firstClick){
      placeMines(i);
      firstClick=false;
      startTimer();
    }

    if (minesMap[i]){
      gameOver=true;
      const el=cellEl(i);
      el.classList.add('mine','open');
      el.textContent='ğŸ’£';
      revealAllMines();
      sfxBoom();
      setToast('ê²Œì„ ì˜¤ë²„!', 'lose');
      if (timerId) clearInterval(timerId);
      return;
    }

    const stack=[i];
    while (stack.length){
      const cur = stack.pop();
      const vv = grid[cur];
      if (vv & OPEN) continue;
      if (vv & FLAG) continue;
      if (minesMap[cur]) continue;

      grid[cur] = vv | OPEN;
      openedCount++;

      const n = grid[cur] & 0x0f;
      const el = cellEl(cur);
      el.classList.add('open');
      el.textContent = n ? String(n) : '';
      if (n) el.classList.add('n'+n);

      // ì‚¬ìš´ë“œëŠ” 0 í™•ì¥í•  ë•Œ ë„ˆë¬´ ë§ì´ ìš¸ë¦¬ì§€ ì•Šê²Œ "ì²« í•œ ë²ˆë§Œ"
      if (stack.length === 0) sfxOpen(n);

      if (n===0){
        const r = (cur / cols) | 0;
        const c = cur % cols;
        for (let dr=-1; dr<=1; dr++){
          for (let dc=-1; dc<=1; dc++){
            if (dr===0 && dc===0) continue;
            const rr=r+dr, cc=c+dc;
            if (!inb(rr,cc)) continue;
            const ni = idx(rr,cc);
            const nv = grid[ni];
            if (nv & OPEN) continue;
            if (nv & FLAG) continue;
            stack.push(ni);
          }
        }
      }
    }

    winCheck();
  }

  // ìš°í´ë¦­ ë©”ë‰´ ë°©ì§€
  boardEl.addEventListener('contextmenu', (e) => e.preventDefault());

  boardEl.addEventListener('click', (e) => {
    const t=e.target;
    if (!t.classList.contains('cell')) return;
    openCell(Number(t.dataset.i));
  });

  boardEl.addEventListener('mousedown', (e) => {
    if (e.button !== 2) return;
    const t=e.target;
    if (!t.classList.contains('cell')) return;
    toggleFlag(Number(t.dataset.i));
  });

  // ëª¨ë°”ì¼ ë¡±í”„ë ˆìŠ¤ ê¹ƒë°œ
  let pressTimer=null;
  boardEl.addEventListener('pointerdown', (e) => {
    const t=e.target;
    if (!t.classList.contains('cell')) return;
    if (e.pointerType === 'mouse') return;

    // ì²« ìƒí˜¸ì‘ìš© ë•Œ ì˜¤ë””ì˜¤ í™œì„±í™”(ëª¨ë°”ì¼ ì •ì±… ëŒ€ì‘)
    ensureAudio();

    const i=Number(t.dataset.i);
    pressTimer = setTimeout(() => {
      toggleFlag(i);
      pressTimer=null;
    }, 420);
  });
  boardEl.addEventListener('pointerup', () => { if (pressTimer){ clearTimeout(pressTimer); pressTimer=null; }});
  boardEl.addEventListener('pointercancel', () => { if (pressTimer){ clearTimeout(pressTimer); pressTimer=null; }});

  // ë²„íŠ¼ë“¤
  soundBtn.addEventListener('click', () => {
    soundOn = !soundOn;
    soundBtn.textContent = soundOn ? 'ì‚¬ìš´ë“œ ON' : 'ì‚¬ìš´ë“œ OFF';
    soundBtn.classList.toggle('toggleOn', soundOn);
    if (soundOn) { ensureAudio(); beep({freq: 740, dur: 0.05, type:'triangle', vol:0.06}); }
  });

  resetBestBtn.addEventListener('click', () => {
    localStorage.removeItem(BEST_KEY);
    refreshBestUI();
    setToast('ìµœê³ ê¸°ë¡ì„ ì´ˆê¸°í™”í–ˆì–´.');
    beep({freq: 220, dur: 0.06, type:'square', vol:0.05});
  });

  levelEl.addEventListener('change', newGame);
  newBtn.addEventListener('click', newGame);

  // ì²« ë¡œë“œ
  refreshBestUI();
  newGame();

  // í´ë¦­/íƒ­ ì‹œ ì˜¤ë””ì˜¤ í™œì„±í™”(ë¸Œë¼ìš°ì € ì •ì±… ëŒ€ì‘)
  document.addEventListener('pointerdown', () => { if (soundOn) ensureAudio(); }, { once:true });
})();
</script>
</body>
</html>